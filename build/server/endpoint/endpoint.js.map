{"version":3,"sources":["../../../server/endpoint/endpoint.js"],"names":["Endpoint","router","path","logger","getInstance","info","app","get","post","put","delete","websocket","debug","ws","helper","getClients","param","_getClients","getWss","clients","init","call","request","response","status","send","allClients","out","Array","from","i","length","clientPath","upgradeReq","route","substring","push","_getGroups","list","map","params"],"mappings":"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","file":"endpoint.js","sourcesContent":["import Logger from '../helper/logger';\n\nclass Endpoint {\n\n    logger = Logger.getInstance();\n\n    constructor(router, path) {\n        this.router = router;\n        this.logger.info('[' + path + '] endpoint invoked!');\n        router.app.get(path, this.get);\n        router.app.post(path, this.post);\n        router.app.put(path, this.put);\n        router.app.delete(path, this.delete);\n        if (typeof this.websocket === 'function') {\n            this.logger.debug('[' + path + '] websocket invoked!');\n            router.app.ws(path, (ws, router) => {\n                this.websocket(ws, router);\n            });\n        }\n\n        this.helper = {\n            getClients: (param) => this._getClients(router.getWss(path).clients, path, param),\n        }\n\n        if (typeof this.init === 'function') {\n            this.init.call(this);\n        }\n    }\n  \n    get(request, response) {\n        response.status(405).send();\n    }\n  \n    post(request, response) {\n        response.status(405).send();\n    }\n  \n    put(request, response) {\n        response.status(405).send();\n    }\n  \n    delete(request, response) {\n        response.status(405).send();\n    }\n\n    _getClients(allClients, path, param = null) {\n        var out = [];\n        let clients = Array.from(allClients);\n        for (let i = 0; i < clients.length; i++) {\n            var clientPath = clients[i].upgradeReq.route.path;\n            clientPath = clientPath.substring(0, clientPath.length - 11);\n            if (clientPath === path) {\n                out.push(clients[i]);\n            }\n        }\n        if (param === null) {\n            return out;\n        } else {\n            return this._getGroups(out, param);\n        }\n        \n    }\n\n    _getGroups(clients, param) {\n        var out = {\n            list: [],\n            map: {}\n        };\n        for(let i = 0; i < clients.length; i++) {\n            if (typeof clients[i].upgradeReq.params[param] === 'undefined') {\n                return clients;\n            }\n            if (typeof out.map[clients[i].upgradeReq.params[param]] === 'undefined') {\n                out.map[clients[i].upgradeReq.params[param]] = [];\n                out.list.push(clients[i].upgradeReq.params[param]);\n            }\n            out.map[clients[i].upgradeReq.params[param]].push(clients[i]);\n        }\n        return out;\n    }\n}\n  \nexport default Endpoint;  "]}