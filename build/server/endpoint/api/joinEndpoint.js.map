{"version":3,"sources":["../../../../server/endpoint/api/joinEndpoint.js"],"names":["JoinEndpoint","worldService","getInstance","queue","heartbeat","every","add","clients","helper","getClients","createGame","ws","request","length","players","forEach","client","push","worldId","createWorld","player","send","terminate"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;;;;;;;IAEMA,Y;;;;;;;;;;;;;;sMAEFC,Y,GAAe,uBAAaC,WAAb,E,QACfC,K,GAAQ,E;;;;;+BAED;AAAA;;AACH,gBAAIC,YAAY,wBAAc,IAAd,CAAhB;AACAA,sBAAUC,KAAV,CAAgB,CAAhB,EAAmBC,GAAnB,CAAuB,YAAM;AACzB,oBAAIC,UAAU,OAAKC,MAAL,CAAYC,UAAZ,EAAd;AACA,uBAAKC,UAAL,CAAgBH,OAAhB;AACH,aAHD;AAIH;;;kCAESI,E,EAAIC,O,EAAS,CAEtB;;;mCAEUL,O,EAAS;AAAA;;AAChB,gBAAIA,QAAQM,MAAR,GAAiB,CAArB,EAAwB;AACxB,gBAAIC,UAAU,EAAd;AACAP,oBAAQQ,OAAR,CAAgB,UAACC,MAAD,EAAY;AACxBF,wBAAQG,IAAR,CAAaD,MAAb;AACA,oBAAIF,QAAQD,MAAR,KAAmB,CAAvB,EAA0B;AACtB,wBAAIK,UAAU,OAAKjB,YAAL,CAAkBkB,WAAlB,EAAd;AACAL,4BAAQC,OAAR,CAAgB,UAACK,MAAD,EAAY;AACxBA,+BAAOC,IAAP,CAAYH,OAAZ;AACAE,+BAAOE,SAAP;AACH,qBAHD;AAIH;AACJ,aATD;AAUH;;;;;;kBAGUtB,Y","file":"joinEndpoint.js","sourcesContent":["import Endpoint from '../endpoint';\nimport HeartBeat from '../../helper/heartBeat';\nimport WorldService from '../../service/worldService';\n\nclass JoinEndpoint extends Endpoint {\n\n    worldService = WorldService.getInstance();\n    queue = [];\n\n    init() {\n        var heartbeat = new HeartBeat(1000);\n        heartbeat.every(3).add(() => {\n            var clients = this.helper.getClients();\n            this.createGame(clients);\n        });\n    }\n\n    websocket(ws, request) {\n\n    }\n\n    createGame(clients) {\n        if (clients.length < 2) return;\n        var players = [];\n        clients.forEach((client) => {\n            players.push(client);\n            if (players.length === 2) {\n                var worldId = this.worldService.createWorld();\n                players.forEach((player) => {\n                    player.send(worldId);\n                    player.terminate();\n                });\n            }\n        });    \n    }\n}\n\nexport default JoinEndpoint;"]}